!function(a,b,c){"use strict";var d="/iPersonal/dashboard/tags",e=Backbone.Model.extend({urlRoot:d,defaults:{tags:[],tagSet:{}},setTags:function(a){for(var b=0;b<a.length;b++)this.attributes.tagSet[a[b]]||(this.attributes.tags.push(a[b]),this.attributes.tagSet[a[b]]=!0)},getTags:function(){return this.attributes.tags},addTags:function(a,b,c,d){var f=this,g={};g.title=c,g.entityType=b,g.entityId=a;var h=new e({entity:g,tags:d});return h.save().complete(function(a){if(201==a.status)for(var b=0;b<d.length;b++)f.attributes.tagSet[d[b]]||(f.attributes.tags.push(d[b]),f.attributes.tagSet[d[b]]=!0)})}});b.tagModel=new e}(jQuery,window,document),function(a,b,c){"use strict";var d=Backbone.Model.extend({defaults:{expenseCategories:[],expenseCategoriesSet:{}},addExpenseCategories:function(a){for(var b=0;b<a.length;b++)this.attributes.expenseCategoriesSet[a[b]]||(this.attributes.expenseCategories.push(a[b]),this.attributes.expenseCategoriesSet[a[b]]=!0)},getExpenseCategories:function(){return this.attributes.expenseCategories}});b.expenseCategoryModel=new d}(jQuery,window,document),function(a,b,c){b.Init={init:function(){this.initBackboneEvents(),this.initSearch()},initBookmark:function(){a("#bookmark-tag").chosen({width:"100%",no_results_text:"Add a new tag and press enter(min 3 chars)"}).trigger("chosen:updated"),this.initChosenDropdowns()},initNote:function(){a("#note-tag").chosen({width:"100%",no_results_text:"Add a new tag and press enter(min 3 chars)"}).trigger("chosen:updated"),this.initChosenDropdowns(),a("#note").wysiwyg(),this.initRTE()},initPin:function(){a("#pin-tag").chosen({width:"100%",no_results_text:"Add a new tag and press enter(min 3 chars)"}).trigger("chosen:updated"),this.initChosenDropdowns()},initTodo:function(){a("#todo-tag").chosen({width:"100%",no_results_text:"Add a new tag and press enter(min 3 chars)"}).trigger("chosen:updated"),this.initChosenDropdowns()},initDiary:function(){a("#diary-tag").chosen({width:"100%",no_results_text:"Add a new tag and press enter(min 3 chars)"}).trigger("chosen:updated"),this.initChosenDropdowns(),a("#diary").wysiwyg(),this.initRTE(),this.initDatePicker()},initExpense:function(){a("#expense-tag").chosen({width:"100%",no_results_text:"Add a new tag and press enter(min 3 chars)"}).trigger("chosen:updated"),a("#expense-category").chosen({width:"100%",no_results_text:"Add a new category and press enter(min 3 chars)"}).trigger("chosen:updated"),this.initChosenDropdowns(),this.initDatePicker()},initDatePicker:function(){a(c).ready(function(){a("input.datepicker").datepicker({format:"yyyy-mm-dd"})})},initBackboneEvents:function(){b.backboneGlobalObj={},_.extend(backboneGlobalObj,Backbone.Events),backboneGlobalObj.on("tag:add",function(a){b.tagModel.addTags(a.entityId,a.entityType,a.entityTitle,a.tags)}),backboneGlobalObj.on("entity:count",function(a){b.entityCountView.refreshCount(a.entityType,a.relativeValue)}),backboneGlobalObj.on("tag:set",function(a){b.tagModel.setTags(a.tags)}),backboneGlobalObj.on("expense_category:set",function(a){b.expenseCategoryModel.addExpenseCategories(a.expenseCategories)}),backboneGlobalObj.on("expense_category:populate",function(a){b.expenseView.populateCategories()}),backboneGlobalObj.on("entity:displaylist",function(a){b.entityListView.renderList(a)})},initChosenDropdowns:function(){a(".chosen-menu").parent().find("div.chosen-container").find("input").on("keyup",function(b){if(13==b.keyCode){var c=a(b.target).val();if(c.length>=3){var d=a(b.target).closest(".form-group").eq(0).children("select");d.append(a("<option></option>").attr("value",c).text(c));var e=d.val();e||(e=[]),e.push(c),d.val(e),d.trigger("chosen:updated")}}})},initRTE:function(){var b=this;b.bold=!1,b.italic=!1,b.underline=!1,a(".btn-group").find("a").on("click",function(){var c=a(this).data("edit");"bold"===c&&(b.bold=1==b.bold?!1:!0),"italic"===c&&(b.italic=1==b.italic?!1:!0),"underline"===c&&(b.underline=1==b.underline?!1:!0),1==b.bold?a(".btn-group").find("a.bold").addClass("btn-info"):a(".btn-group").find("a.bold").removeClass("btn-info"),1==b.italic?a(".btn-group").find("a.italic").addClass("btn-info"):a(".btn-group").find("a.italic").removeClass("btn-info"),1==b.underline?a(".btn-group").find("a.underline").addClass("btn-info"):a(".btn-group").find("a.underline").removeClass("btn-info")})},initSearch:function(){a("#search-tag").chosen({width:"100%",no_results_text:"Add a tag and press enter(min 3 chars)"}).trigger("chosen:updated"),a("#search-title").chosen({width:"100%",no_results_text:"Add a tag and press enter(min 3 chars)"}).trigger("chosen:updated"),a("#search-keyword").chosen({width:"100%",no_results_text:"Add a tag and press enter(min 3 chars)"}).trigger("chosen:updated"),a("#search-entity").chosen({width:"100%",no_results_text:"Add a tag and press enter(min 3 chars)"}).trigger("chosen:updated"),a("#search-category").chosen({width:"100%",no_results_text:"Add a category and press enter (min 3 chars)"}),this.initChosenDropdowns(),this.initDatePicker()}},Init.init()}(jQuery,window,document),function(a,b,c){"use strict";var d=Backbone.Model.extend({urlRoot:"/iPersonal/dashboard/users"}),e=Backbone.View.extend({el:a("span.username"),template:a("#username-template").html(),initialize:function(){this.getUserData()},getUserData:function(){var a=this;userModel.fetch().complete(function(b){200==b.status&&(a.render(),userModel.get("tags")&&backboneGlobalObj.trigger("tag:set",{tags:userModel.get("tags")}),userModel.get("expenseCategories")&&backboneGlobalObj.trigger("expense_category:set",{expenseCategories:userModel.get("expenseCategories")}))})},render:function(){var a=_.template(this.template);return this.$el.html(a(userModel.toJSON())),this}});b.userModel=new d,b.userView=new e}(jQuery,window,document),function(a,b,c){"use strict";b.Base=Backbone.Model.extend({defaults:{mandatory:{},maxLength:{},type:{},nonModelAttrs:{}},validate:function(b){var c={};for(var d in this.mandatory)b[d]?"date"==d&&isNaN(b[d])&&(c[d]=d+" is Invalid"):c[d]=d+" cannot be empty";for(var d in this.maxLength)b[d]&&b[d].length>this.maxLength[d]&&(c[d]=d+" cannot exceed "+this.maxLength[d]+" characters");for(var d in this.type)("int"==this.type[d]||"double"==this.type[d])&&b[d]&&isNaN(parseInt(b[d]))&&(c[d]="Invalid value for "+d);for(var d in this.nonModelAttrs)delete b[d];return a.isEmptyObject(c)?!1:c}}),b.BaseView=Backbone.View.extend({resetValues:function(a){a&&a.preventDefault(),this.$el.empty()},renderErrors:function(a){for(var b=0;b<this.model.formAttributes.length;b++){var c=this.model.formAttributes[b];a[c]?(this.saveForm.find("[name="+c+"]").addClass("error-field"),this.saveForm.find("."+c+"-error").html(a[c])):(this.saveForm.find("[name="+c+"]").removeClass("error-field").val(),this.saveForm.find("."+c+"-error").html(""))}},buildErrorObject:function(a){for(var b=JSON.parse(a.responseText).errorEntity,c={},d=0;d<this.model.formAttributes.length;d++){var e=this.model.formAttributes[d];c[e]=[]}if(b instanceof Array)for(var d=0;d<b.length;d++){var f=b[d];c[f.field].push(f.description)}else{var f=b;c[f.field].push(f.description)}for(var g in c)c[g]=c[g].join(";");return c},displayTagSelection:function(b){this.tagImage.addClass("invisible"),this.searchTag.parent("div.form-group").removeClass("invisible");var c=tagModel.getTags();if(c){for(var d=0;d<c.length;d++)this.searchTag.append(a("<option></option>").attr("value",c[d]).text(c[d]));this.searchTag.trigger("chosen:updated")}},postCreation:function(a,b,c,d,e,f){e&&backboneGlobalObj.trigger("tag:add",{entityId:a,entityType:b,entityTitle:c,tags:e}),backboneGlobalObj.trigger("entity:count",{entityType:b,relativeValue:d}),f&&backboneGlobalObj.trigger("expense_category:set",{expenseCategories:f}),this.resetValues()},renderCreateTemplate:function(){var a=_.template(this.upsertTemplate);this.$el.html(a(this.getModel().toJSON())),this.$el.fadeIn().removeClass("invisible").siblings().fadeOut().addClass("invisible")},displayEntity:function(a,b,c){for(var d,e=0;e<this.collection.models.length;e++)if(this.collection.models[e].attributes[b]===a){d=this.collection.models[e],d.set({entityType:c});break}if(d)this._displayEntity(d,c);else{var f=this,g=this.getModel();g.set({id:a});var h=g.fetch({success:function(a){},error:function(a){}});h.complete(function(b){if(200==b.status){var d=JSON.parse(b.responseText),d=f.buildModel(d);if(d.set({entityType:c}),d.set({id:a}),d.attributes.tags&&!(d.attributes.tags instanceof Array)){var e=[];e.push(d.attributes.tags),d.set({tags:e})}f._displayEntity(d,c)}})}},_displayEntity:function(b,c){if(b.get("tags")||b.set({tags:[]}),"expense"!=c||b.get("categories")||b.set({categories:[]}),"todo"==c&&b.attributes.tasks.models instanceof Array){for(var d=[],e=0;e<b.attributes.tasks.models.length;e++)d.push(b.attributes.tasks.models[e].attributes);b.set({tasks:d})}var f=_.template(this.displayTemplate);this.$el.html(f(b.toJSON())),this.$el.fadeIn().removeClass("invisible").siblings().fadeOut().addClass("invisible");var g=this;a("img.delete").confirmation({placement:"bottom",onConfirm:function(){g.deleteEntity()}});var g=this;a("img.edit").on("click",function(){g.editEntity(b),"todo"==c&&(g.buildTaskObj(b),g.renderTasks())})},findIndex:function(a){for(var b=0;b<this.collection.models.length&&this.collection.models[b].attributes.id!=a;b++);return b},findModel:function(a){var b=this.findIndex(a);return this.collection.at(b)},editEntity:function(b){var c=(a("img.edit").data("id"),_.template(this.upsertTemplate));this.$el.html(c(b.toJSON())),this.$el.fadeIn().removeClass("invisible").siblings().fadeOut().addClass("invisible"),this.initializeUpdateForm(),this.displayTagSelection()},deleteEntity:function(){var b=this,c=a("img.delete").data("id"),d=this.getDeletableModel(c),e=d.destroy();e&&e.complete(function(a){if(200==a.status){b.$el.empty();var d=b.findIndex(c);b.collection.remove(b.collection.at(d));var e=b.buildEntityList();backboneGlobalObj.trigger("entity:displaylist",e),backboneGlobalObj.trigger("entity:count",{entityType:b.entityType,relativeValue:-1})}})}})}(jQuery,window,document),function(a,b,c){"use strict";var d="/iPersonal/dashboard/bookmarks",e=Base.extend({urlRoot:d,initialize:function(){this.mandatory={name:!0,url:!0,description:!0},this.maxLength={name:50,url:150,description:1e3},this.formAttributes=["name","url","description"]}}),f=Backbone.Collection.extend({model:e}),g=BaseView.extend({entityType:"BOOKMARK",el:a("#bookmark-wrapper"),upsertTemplate:a("#bookmark-upsert-template").html(),displayTemplate:a("#bookmark-display-template").html(),events:{"click #book-submit":"upsertBookmark","click #book-cancel":"resetValues","click #book-tag-img":"displayTagSelection"},getModel:function(){return new e({name:"",description:"",url:"",tags:[]})},buildModel:function(a){return new e(a)},prepareVariables:function(){this.saveForm=a("#bookmark-form"),this.tagImage=a("#book-tag-img"),this.searchTag=a("#bookmark-tag")},initializeUpdateForm:function(){this.prepareVariables(),Init.initBookmark()},upsertBookmark:function(a){var b=this;a.preventDefault();var c=b.saveForm.find(".entityId").html();c?b.model=new e({id:c,bookmarkId:c}):b.model=new e,b.model.set({name:b.saveForm.find("[name=name]").val(),url:b.saveForm.find("[name=url]").val(),description:b.saveForm.find("[name=description]").val()}),b.model.on("invalid",function(a,c){b.renderErrors(c)});var d=b.model.save({success:function(a){},error:function(a){}});d&&d.complete(function(a){if(201!=a.status&&200!=a.status){var d=b.buildErrorObject(a,b);b.renderErrors(d)}else{var e=b.searchTag.val();c?(b.postCreation(c,"BOOKMARK",b.model.get("name"),0,e),b.model.set({id:c,modifiedAt:Math.floor(Date.now()),tags:e}),b.collection.remove(b.collection.at(b.findIndex(c)))):(b.postCreation(a.responseText,"BOOKMARK",b.model.get("name"),1,e),b.model.set({id:a.responseText,createdOn:Math.floor(Date.now()),modifiedAt:Math.floor(Date.now()),tags:e})),b.collection.unshift(b.model);var f=b.buildEntityList();backboneGlobalObj.trigger("entity:displaylist",f)}})},fetchBookmarks:function(a){var b=this;if(a&&a.preventDefault(),this.collection.length==parseInt(entityCountModel.attributes.bookmarks)){var c=this.buildEntityList();return void backboneGlobalObj.trigger("entity:displaylist",c)}this.model=new e,this.model.fetch({data:{offset:this.collection.length,limit:20}}).complete(function(a){if(200==a.status){var c=JSON.parse(a.responseText).bookmark;if(c instanceof Array)for(var d in c){var f=new e(c[d]);if(f.set({id:c[d].bookmarkId}),f.attributes.tags&&!(f.attributes.tags instanceof Array)){var g=[];g.push(f.attributes.tags),f.set({tags:g})}b.collection.push(f)}else if(c){var f=new e(c);if(f.set({id:c.bookmarkId}),f.attributes.tags&&!(f.attributes.tags instanceof Array)){var g=[];g.push(f.attributes.tags),f.set({tags:g})}b.collection.push(f)}var h=b.buildEntityList();backboneGlobalObj.trigger("entity:displaylist",h)}})},buildEntityList:function(){for(var a=[],b=0;b<this.collection.length;b++){var c=this.collection.models[b].attributes.description,d={entityId:this.collection.models[b].attributes.id,entityTitle:this.collection.models[b].attributes.name,url:this.collection.models[b].attributes.url,entitySummary:c?c.substring(0,100):c,entityType:"bookmark",modifiedAt:this.collection.models[b].attributes.modifiedAt};a.push(d)}return a},getDeletableModel:function(a){return new e({id:a})}});b.bookmarkView=new g({collection:new f})}(jQuery,window,document),function(a,b,c){"use strict";var d="/iPersonal/dashboard/notes",e=Base.extend({urlRoot:d,initialize:function(){this.mandatory={title:!0,note:!0},this.maxLength={title:50,note:1e3},this.formAttributes=["title","note"]}}),f=Backbone.Collection.extend({model:e}),g=BaseView.extend({el:a("#note-wrapper"),entityType:"NOTE",upsertTemplate:a("#note-upsert-template").html(),displayTemplate:a("#note-display-template").html(),events:{"click #note-submit":"upsertNote","click #note-cancel":"resetValues","click #note-tag-img":"displayTagSelection"},getModel:function(a){return new e({title:"",note:"",tags:[]})},buildModel:function(a){return new e(a)},prepareVariables:function(){this.saveForm=a("#note-form"),this.tagImage=a("#note-tag-img"),this.searchTag=a("#note-tag"),this.noteRTE=a("#note")},initializeUpdateForm:function(){this.prepareVariables(),Init.initNote()},resetValues:function(a){a&&a.preventDefault(),BaseView.prototype.resetValues.apply(this,arguments),this.noteRTE.empty()},upsertNote:function(a){var b=this;a.preventDefault();var c=b.saveForm.find(".entityId").html();c?b.model=new e({id:c,noteId:c}):b.model=new e,b.model.set({title:b.saveForm.find("[name=title]").val(),note:b.saveForm.find("div#note").cleanHtml()}),b.model.on("invalid",function(a,c){b.renderErrors(c)});var d=b.model.save({success:function(a){},error:function(a){}});d&&d.complete(function(a){if(201!=a.status&&200!=a.status){var d=b.buildErrorObject(a,b);b.renderErrors(d)}else{var e=b.searchTag.val();if(c){var f=b.model.get("note").replace(/<(?:.|\n)*?>/gm,"").trim();b.postCreation(c,"NOTE",b.model.get("title"),0,e),b.model.set({id:c,modifiedAt:Math.floor(Date.now()),summary:f,tags:e}),b.collection.remove(b.collection.at(b.findIndex(c)))}else b.postCreation(a.responseText,"NOTE",b.model.get("title"),1,e),b.model.set({id:a.responseText,createdOn:Math.floor(Date.now()),modifiedAt:Math.floor(Date.now()),summary:b.model.get("note").replace(/<(?:.|\n)*?>/gm,"").trim(),tags:e});b.collection.unshift(b.model);var g=b.buildEntityList();backboneGlobalObj.trigger("entity:displaylist",g)}})},fetchNotes:function(a){var b=this;if(a&&a.preventDefault(),this.collection.length==parseInt(entityCountModel.attributes.notes)){var c=this.buildEntityList();return void backboneGlobalObj.trigger("entity:displaylist",c)}this.model=new e,this.model.fetch({data:{offset:this.collection.length,limit:20}}).complete(function(a){if(200==a.status){var c=JSON.parse(a.responseText).note;if(c instanceof Array)for(var d in c){var f=new e(c[d]);if(f.set({id:c[d].noteId}),f.attributes.tags&&!(f.attributes.tags instanceof Array)){var g=[];g.push(f.attributes.tags),f.set({tags:g})}b.collection.push(f)}else if(c){var f=new e(c);if(f.set({id:c.noteId}),f.attributes.tags&&!(f.attributes.tags instanceof Array)){var g=[];g.push(f.attributes.tags),f.set({tags:g})}b.collection.push(f)}var h=b.buildEntityList();backboneGlobalObj.trigger("entity:displaylist",h)}})},buildEntityList:function(){for(var a=[],b=0;b<this.collection.length;b++){var c=this.collection.models[b].attributes.summary,d={entityId:this.collection.models[b].attributes.id,entityTitle:this.collection.models[b].attributes.title,entitySummary:c?c.substring(0,100):c,entityType:"note",modifiedAt:this.collection.models[b].attributes.modifiedAt};a.push(d)}return a},getDeletableModel:function(a){return new e({id:a})}});b.noteView=new g({collection:new f})}(jQuery,window,document),function(a,b,c){"use strict";var d="/iPersonal/dashboard/pins",e=Base.extend({urlRoot:d,initialize:function(){this.mandatory={name:!0,imageUrl:!0,description:!0},this.maxLength={name:50,imageUrl:150,description:1e3},this.formAttributes=["name","imageUrl","description"]}}),f=Backbone.Collection.extend({model:e}),g=BaseView.extend({el:a("#pin-wrapper"),entityType:"PIN",upsertTemplate:a("#pin-upsert-template").html(),displayTemplate:a("#pin-display-template").html(),events:{"click #pin-submit":"upsertPin","click #pin-cancel":"resetValues","click #pin-tag-img":"displayTagSelection"},getModel:function(a){return new e({name:"",description:"",imageUrl:"",tags:[]})},buildModel:function(a){return new e(a)},prepareVariables:function(){this.tagImage=a("#pin-tag-img"),this.searchTag=a("#pin-tag"),this.saveForm=a("#pin-form")},initializeUpdateForm:function(){this.prepareVariables(),Init.initPin()},upsertPin:function(a){var b=this;a.preventDefault();var c=b.saveForm.find(".entityId").html();c?b.model=new e({id:c,pinId:c}):b.model=new e,b.model.set({name:b.saveForm.find("[name=name]").val(),imageUrl:b.saveForm.find("[name=imageUrl]").val(),description:b.saveForm.find("[name=description]").val()}),b.model.on("invalid",function(a,c){b.renderErrors(c)});var d=b.model.save({success:function(a){},error:function(a){}});d&&d.complete(function(a){if(201!=a.status&&200!=a.status){var d=b.buildErrorObject(a,b);b.renderErrors(d)}else{var e=b.searchTag.val();c?(b.postCreation(c,"PIN",b.model.get("name"),0,e),b.model.set({id:c,modifiedAt:Math.floor(Date.now()),tags:e}),b.collection.remove(b.collection.at(b.findIndex(c)))):(b.postCreation(a.responseText,"PIN",b.model.get("name"),1,e),b.model.set({id:a.responseText,createdOn:Math.floor(Date.now()),modifiedAt:Math.floor(Date.now()),tags:e})),b.collection.unshift(b.model);var f=b.buildEntityList();backboneGlobalObj.trigger("entity:displaylist",f)}})},fetchPins:function(a){var b=this;if(a&&a.preventDefault(),this.collection.length==parseInt(entityCountModel.attributes.pins)){var c=this.buildEntityList();return void backboneGlobalObj.trigger("entity:displaylist",c)}this.model=new e,this.model.fetch({data:{offset:this.collection.length,limit:20}}).complete(function(a){if(200==a.status){var c=JSON.parse(a.responseText).pin;if(c instanceof Array)for(var d in c){var f=new e(c[d]);if(f.set({id:c[d].pinId}),f.attributes.tags&&!(f.attributes.tags instanceof Array)){var g=[];g.push(f.attributes.tags),f.set({tags:g})}b.collection.push(f)}else if(c){var f=new e(c);if(f.set({id:c.pinId}),f.attributes.tags&&!(f.attributes.tags instanceof Array)){var g=[];g.push(f.attributes.tags),f.set({tags:g})}b.collection.push(f)}var h=b.buildEntityList();backboneGlobalObj.trigger("entity:displaylist",h)}})},buildEntityList:function(){for(var a=[],b=0;b<this.collection.length;b++){var c=this.collection.models[b].attributes.description,d={entityId:this.collection.models[b].attributes.id,entityTitle:this.collection.models[b].attributes.name,url:this.collection.models[b].attributes.imageUrl,entitySummary:c?c.substring(0,100):c,entityType:"pin",modifiedAt:this.collection.models[b].attributes.modifiedAt};a.push(d)}return a},getDeletableModel:function(a){return new e({id:a})}});b.pinView=new g({collection:new f})}(jQuery,window,document),function(a,b,c){"use strict";var d="/iPersonal/dashboard/todos",e=Base.extend({urlRoot:d,initialize:function(){this.mandatory={title:!0},this.maxLength={title:50},this.formAttributes=["title"]}}),f=Backbone.Collection.extend({model:e}),g=Base.extend({initialize:function(){this.mandatory={name:!0,task:!0},this.maxLength={name:50,task:300},this.formAttributes=["name","task"]}}),h=Backbone.Collection.extend({model:g}),i=BaseView.extend({entityType:"TODO",el:a("#todo-wrapper"),upsertTemplate:a("#todo-upsert-template").html(),displayTemplate:a("#todo-display-template").html(),taskTemplate:a("#task-display-template").html(),events:{"click #todo-submit":"upsertTodo","click #todo-cancel":"resetValues","click #todo-tag-img":"displayTagSelection","click .add-task":"showTaskForm","click #task-add-button":"addTask","click #task-cancel-button":"cancelTask","click .delete":"deleteTask","click a.edit":"editTask"},showTaskForm:function(a){return a&&a.preventDefault(),this.taskCollection.length>=10?void this.$el.find(".task-length-limit").removeClass("invisible").fadeIn():(this.$el.find(".add-task").addClass("invisible").fadeOut(),void this.$el.find("#task-form").removeClass("invisible").fadeIn())},getModel:function(){return new e({title:"",tasks:[],tags:[]})},buildModel:function(a){return new e(a)},prepareVariables:function(){this.taskCollection=new h,this.saveForm=a("#todo-form"),this.tasksDiv=a("#tasks"),this.searchTag=a("#todo-tag"),this.tagImage=a("#todo-tag-img"),this.saveForm.find("[name=percent-completion]").on("change",this.showPercentTitle)},showPercentTitle:function(b){a(b.target).parent(".form-group").find(".percent-completion-label").html("Percent Completion: "+a(b.target).val()+"%")},initializeUpdateForm:function(){this.prepareVariables(),Init.initTodo()},upsertTodo:function(a){var b=this;a.preventDefault();var c=b.saveForm.find(".entityId").html(),d=b.taskCollection.models[0].attributes.task;c?b.model=new e({id:c,todoId:c}):b.model=new e,b.model.set({title:b.saveForm.find("[name=title]").val(),tasks:b.taskCollection}),b.model.on("invalid",function(a,c){b.renderErrors(c)});var f=b.model.save({success:function(a){},error:function(a){}});f&&f.complete(function(a){if(201!=a.status&&200!=a.status){var e=b.buildErrorObject(a,b);b.renderErrors(e)}else{var f=b.searchTag.val();c?(b.postCreation(c,"TODO",b.model.get("title"),0,f),b.model.set({id:c,modifiedAt:Math.floor(Date.now()),tags:f,summary:d}),b.collection.remove(b.collection.at(b.findIndex(c)))):(b.postCreation(a.responseText,"TODO",b.model.get("title"),1,f),b.model.set({id:a.responseText,createdOn:Math.floor(Date.now()),modifiedAt:Math.floor(Date.now()),tags:f,summary:d})),b.collection.unshift(b.model);var g=b.buildEntityList();backboneGlobalObj.trigger("entity:displaylist",g)}})},fetchTodos:function(a){var b=this;if(a&&a.preventDefault(),this.collection.length==parseInt(entityCountModel.attributes.todos)){var c=this.buildEntityList();return void backboneGlobalObj.trigger("entity:displaylist",c)}this.model=new e,this.model.fetch({data:{offset:this.collection.length,limit:20}}).complete(function(a){if(200==a.status){var c=JSON.parse(a.responseText).todo;if(c instanceof Array)for(var d in c){var f=new e(c[d]);if(f.set({id:c[d].todoId}),f.attributes.tasks instanceof Array)var g=f.attributes.tasks[0].task;else var g=f.attributes.tasks.task;if(f.set({summary:g}),f.attributes.tags&&!(f.attributes.tags instanceof Array)){var h=[];h.push(f.attributes.tags),f.set({tags:h})}b.collection.push(f)}else if(c){var f=new e(c);if(f.set({id:c.todoId}),f.attributes.tasks instanceof Array)var g=f.attributes.tasks[0].task;else var g=f.attributes.tasks.task;if(f.set({summary:g}),f.attributes.tags&&!(f.attributes.tags instanceof Array)){var h=[];h.push(f.attributes.tags),f.set({tags:h})}b.collection.push(f)}var i=b.buildEntityList();backboneGlobalObj.trigger("entity:displaylist",i)}})},buildEntityList:function(){for(var a=[],b=0;b<this.collection.length;b++){var c=this.collection.models[b].attributes.description,d={entityId:this.collection.models[b].attributes.id,entityTitle:this.collection.models[b].attributes.title,entityType:"todo",entitySummary:c?c.substring(0,100):c,modifiedAt:this.collection.models[b].attributes.modifiedAt,entitySummary:this.collection.models[b].attributes.summary};a.push(d)}return a},getDeletableModel:function(a){return new e({id:a})},buildTaskObj:function(a){if(this.taskCollection=new h,a.attributes.tasks instanceof Array)for(var b=0;b<a.attributes.tasks.length;b++){var c=new g(a.attributes.tasks[b]);this.taskCollection.add(c)}else{var c=new g(a.attributes.tasks);this.taskCollection.add(c)}},addTask:function(a){a.preventDefault();var b=this.$el.find(".taskId").html();b?(this.model=this.taskCollection.get(b),this.model.set({name:this.$el.find("[name=name]").val(),task:this.$el.find("[name=task]").val(),priority:this.$el.find("[name=priority]:checked").val(),percentCompletion:this.$el.find("[name=percent-completion]").val()})):this.model=new g({name:this.$el.find("[name=name]").val(),task:this.$el.find("[name=task]").val(),priority:this.$el.find("[name=priority]:checked").val(),percentCompletion:this.$el.find("[name=percent-completion]").val()});var c=this.model.validate(this.model.attributes);return c?void this.renderErrors(c):(this.resetTask(),this.taskCollection.add(this.model),void this.renderTasks())},cancelTask:function(a){a.preventDefault(),this.resetTask()},resetTask:function(){this.$el.find("#task-form").addClass("invisible").fadeOut(),this.$el.find(".add-task").removeClass("invisible").fadeIn(),this.$el.find(".taskId").empty(),this.$el.find("[name=name]").val("").removeClass("error-field"),this.$el.find(".name-error").html(""),this.$el.find("[name=task]").val("").removeClass("error-field"),this.$el.find(".task-error").html(""),this.$el.find("[name=percent-completion]").val(0),this.$el.find(".percent-completion-label").html("Percent Completion: 0 %")},editTask:function(b){var c=a(b.target).closest(".task-entity"),d=c.find(".name").html(),e=c.find(".task").html().trim(),f=c.find(".priority").html(),g=c.find(".id").html(),h=c.find(".percentCompletion").html().split(" ");this.$el.find(".taskId").html(g),this.$el.find("[name=name]").val(d),this.$el.find("[name=task]").val(e),this.$el.find("[name=percent-completion]").val(h),this.$el.find(".percent-completion-label").html("Percent Completion: "+h+"%"),this.$el.find("[name=priority]").removeAttr("checked"),this.$el.find("#"+f.toLowerCase()).click(),this.showTaskForm()},deleteTask:function(b){var c=a(b.target).closest("div.task-entity").find(".id").html();this.taskCollection.remove(this.taskCollection.get(c)),this.renderTasks()},buildTaskList:function(){for(var a=[],b=0;b<this.taskCollection.length;b++){var c={id:this.taskCollection.models[b].cid,priority:this.taskCollection.models[b].attributes.priority,percentCompletion:this.taskCollection.models[b].attributes.percentCompletion,name:this.taskCollection.models[b].attributes.name,task:this.taskCollection.models[b].attributes.task};a.push(c)}return a},renderTasks:function(){this.tasksDiv.empty();var a=this.buildTaskList(),b=_.template(this.taskTemplate);this.tasksDiv.html(b({tasks:a}))}});b.todoView=new i({collection:new f})}(jQuery,window,document),function(a,b,c){"use strict";var d="/iPersonal/dashboard/diaries",e=Base.extend({urlRoot:d,initialize:function(){this.mandatory={title:!0,content:!0,date:!0},this.maxLength={title:50,content:3e3},this.formAttributes=["title","content","date"]}}),f=Backbone.Collection.extend({model:e}),g=BaseView.extend({entityType:"DIARY",el:a("#diary-wrapper"),upsertTemplate:a("#diary-upsert-template").html(),displayTemplate:a("#diary-display-template").html(),events:{"click #diary-submit":"upsertDiary","click #diary-cancel":"resetValues","click #diary-tag-img":"displayTagSelection"},getModel:function(){return new e({title:"",content:"",dateStr:"",tags:[]})},buildModel:function(a){return a.dateStr=a.year+"-"+a.month+"-"+a.date,new e(a)},prepareVariables:function(){this.saveForm=a("#diary-form"),this.tagImage=a("#diary-tag-img"),this.searchTag=a("#diary-tag"),this.diaryRTE=a("#diary")},initializeUpdateForm:function(){this.prepareVariables(),Init.initDiary()},resetValues:function(a){a&&a.preventDefault(),BaseView.prototype.resetValues.apply(this,arguments),this.diaryRTE.empty()},upsertDiary:function(a){var b=this;a.preventDefault();var c=b.saveForm.find(".entityId").html();c?b.model=new e({id:c,pageId:c}):b.model=new e,b.model.set({title:b.saveForm.find("[name=title]").val(),content:b.saveForm.find("div#diary").cleanHtml(),year:b.saveForm.find("[name=date]").val().split("-")[0],month:b.saveForm.find("[name=date]").val().split("-")[1],date:b.saveForm.find("[name=date]").val().split("-")[2],dateStr:b.saveForm.find("[name=date]").val()});var d=b.model.validate(b.model.attributes);if(d)return void b.renderErrors(d);b.model.on("invalid",function(a,c){b.renderErrors(c)});var f=b.model.save({success:function(a){},error:function(a){}});f&&f.complete(function(a){if(201!=a.status&&200!=a.status){var d=b.buildErrorObject(a,b);b.renderErrors(d)}else{var e=b.searchTag.val();c?(b.postCreation(c,"DIARY",b.model.get("title"),0,e),b.model.set({id:c,modifiedAt:Math.floor(Date.now()),tags:e,summary:b.model.get("content").replace(/<(?:.|\n)*?>/gm,"").trim()}),b.collection.remove(b.collection.at(b.findIndex(c)))):(b.postCreation(a.responseText,"DIARY",b.model.get("title"),1,e),b.model.set({id:a.responseText,createdOn:Math.floor(Date.now()),modifiedAt:Math.floor(Date.now()),tags:e,summary:b.model.get("content").replace(/<(?:.|\n)*?>/gm,"").trim()})),b.collection.unshift(b.model);var f=b.buildEntityList();backboneGlobalObj.trigger("entity:displaylist",f)}})},fetchPages:function(a){var b=this;if(a&&a.preventDefault(),this.collection.length==parseInt(entityCountModel.attributes.diaries)){var c=this.buildEntityList();return void backboneGlobalObj.trigger("entity:displaylist",c)}this.model=new e,this.model.fetch({data:{offset:this.collection.length,limit:20}}).complete(function(a){if(200==a.status){var c=JSON.parse(a.responseText).page;if(c instanceof Array)for(var d in c){var f=new e(c[d]);if(f.set({id:c[d].pageId}),f.attributes.tags&&!(f.attributes.tags instanceof Array)){var g=[];g.push(f.attributes.tags),f.set({tags:g})}f.set({dateStr:f.get("year")+"-"+f.get("month")+"-"+f.get("date")}),b.collection.push(f)}else if(c){var f=new e(c);if(f.set({id:c.pageId}),f.attributes.tags&&!(f.attributes.tags instanceof Array)){var g=[];g.push(f.attributes.tags),f.set({tags:g})}f.set({dateStr:f.get("year")+"-"+f.get("month")+"-"+f.get("date")}),b.collection.push(f)}var h=b.buildEntityList();backboneGlobalObj.trigger("entity:displaylist",h)}})},buildEntityList:function(){for(var a=[],b=0;b<this.collection.length;b++){var c=this.collection.models[b].attributes.summary,d={entityId:this.collection.models[b].attributes.id,entityTitle:this.collection.models[b].attributes.title,entitySummary:c?c.substring(0,100):c,entityType:"diary",dateStr:this.collection.models[b].attributes.dateStr,year:this.collection.models[b].attributes.year,month:this.collection.models[b].attributes.month,date:this.collection.models[b].attributes.date,modifiedAt:this.collection.models[b].attributes.modifiedAt};a.push(d)}return a},getDeletableModel:function(a){return new e({id:a})}});b.diaryView=new g({collection:new f})}(jQuery,window,document),function(a,b,c){"use strict";var d="/iPersonal/dashboard/expenses",e="/iPersonal/dashboard/expenses/search",f=Base.extend({urlRoot:d,initialize:function(){this.mandatory={title:!0,amount:!0,description:!0,date:!0},this.maxLength={title:50,description:1e3},this.type={amount:"double"},this.formAttributes=["title","description","amount","date","categories"]}}),g=Backbone.Model.extend({urlRoot:e}),h=Backbone.Collection.extend({model:f}),i=BaseView.extend({el:a("#expense-wrapper"),entityType:"EXPENSE",upsertTemplate:a("#expense-upsert-template").html(),
displayTemplate:a("#expense-display-template").html(),events:{"click #exp-submit":"upsertExpense","click #exp-cancel":"resetValues","click #exp-tag-img":"displayTagSelection"},getModel:function(a){return new f({title:"",description:"",amount:"",date:"",tags:[],categories:[]})},buildModel:function(a){return new f(a)},prepareVariables:function(){this.saveForm=a("#expense-form"),this.tagImage=a("#exp-tag-img"),this.searchTag=a("#expense-tag"),this.categoryDropDown=a("#expense-form").find("[name=categories]"),this.populateCategories()},initializeUpdateForm:function(){this.prepareVariables(),Init.initExpense()},resetValues:function(a){a&&a.preventDefault(),BaseView.prototype.resetValues.apply(this,arguments),this.categoryDropDown.val("").trigger("chosen:updated")},populateCategories:function(b){var c=expenseCategoryModel.getExpenseCategories();if(c){for(var d=0;d<c.length;d++)this.categoryDropDown.append(a("<option></option>").attr("value",c[d]).text(c[d]));this.categoryDropDown.trigger("chosen:updated")}},getDeletableModel:function(a){return new f({id:a})},upsertExpense:function(a){var b=this;a.preventDefault();var c=b.saveForm.find(".entityId").html();c?b.model=new f({id:c,expenseId:c}):b.model=new f,b.model.set({title:b.saveForm.find("[name=title]").val(),description:b.saveForm.find("[name=description]").val(),amount:b.saveForm.find("[name=amount]").val(),date:(new Date(b.saveForm.find("[name=date]").val()).getTime()/1e3).toFixed(0),categories:b.saveForm.find("[name=categories]").val()}),b.model.on("invalid",function(a,c){b.renderErrors(c)});var d=b.model.save({success:function(a){},error:function(a){}});d&&d.complete(function(a){if(201!=a.status&&200!=a.status){var d=b.buildErrorObject(a,b);b.renderErrors(d)}else{var e=b.searchTag.val();c?(b.postCreation(c,"EXPENSE",b.model.get("title"),0,e,b.model.get("categories")),b.model.set({id:c,modifiedAt:Math.floor(Date.now()),tags:e}),b.collection.remove(b.collection.at(b.findIndex(c)))):(b.postCreation(a.responseText,"EXPENSE",b.model.get("title"),1,e,b.model.get("categories")),b.model.set({id:a.responseText,createdOn:Math.floor(Date.now()),modifiedAt:Math.floor(Date.now()),tags:e})),b.collection.unshift(b.model);var f=b.buildEntityList();backboneGlobalObj.trigger("entity:displaylist",f)}})},fetchExpenses:function(a){var b=this;if(a&&a.preventDefault(),this.collection.length==parseInt(entityCountModel.attributes.expenses)){var c=this.buildEntityList();return void backboneGlobalObj.trigger("entity:displaylist",c)}this.model=new g,this.model.set({url:"/iPersonal/dashboard/expenses/search"}),this.model.save({data:{offset:this.collection.length,limit:20}}).complete(function(a){if(200==a.status){var c=JSON.parse(a.responseText).expense;if(c instanceof Array)for(var d in c){var e=new f(c[d]);if(e.set({id:c[d].expenseId}),e.attributes.tags&&!(e.attributes.tags instanceof Array)){var g=[];g.push(e.attributes.tags),e.set({tags:g})}if(e.attributes.categories&&!(e.attributes.categories instanceof Array)){var h=[];h.push(e.attributes.categories),e.set({categories:h})}b.collection.push(e)}else if(c){var e=new f(c);if(e.set({id:c.expenseId}),e.attributes.tags&&!(e.attributes.tags instanceof Array)){var g=[];g.push(e.attributes.tags),e.set({tags:g})}if(e.attributes.categories&&!(e.attributes.categories instanceof Array)){var h=[];h.push(e.attributes.categories),e.set({categories:h})}b.collection.push(e)}var i=b.buildEntityList();backboneGlobalObj.trigger("entity:displaylist",i)}})},buildEntityList:function(){for(var a=[],b=0;b<this.collection.length;b++){var c=this.collection.models[b].attributes.description,d={entityId:this.collection.models[b].attributes.id,entityTitle:this.collection.models[b].attributes.title,amount:this.collection.models[b].attributes.amount,entitySummary:c?c.substring(0,100):c,entityType:"expense",modifiedAt:this.collection.models[b].attributes.modifiedAt};a.push(d)}return a},buildFilterEntityList:function(){for(var a=[],b=0;b<this.expenseFilterCollection.length;b++){var c=this.expenseFilterCollection.models[b].attributes.description,d={entityId:this.expenseFilterCollection.models[b].attributes.id,entityTitle:this.expenseFilterCollection.models[b].attributes.title,amount:this.expenseFilterCollection.models[b].attributes.amount,entitySummary:c?c.substring(0,100):c,entityType:"expense",modifiedAt:this.expenseFilterCollection.models[b].attributes.modifiedAt};a.push(d)}return a},searchExpenses:function(b){var c=this,b=new g(b);b.save({data:{offset:0,limit:20}}).complete(function(b){if(c.expenseFilterCollection=new h,200==b.status&&null!=JSON.parse(b.responseText)){var d=JSON.parse(b.responseText).expense;if(d instanceof Array)for(var e in d){var g=new f(d[e]);if(g.set({id:d[e].expenseId}),g.attributes.tags&&!(g.attributes.tags instanceof Array)){var i=[];i.push(g.attributes.tags),g.set({tags:i})}if(g.attributes.categories&&!(g.attributes.categories instanceof Array)){var j=[];j.push(g.attributes.categories),g.set({categories:j})}c.expenseFilterCollection.push(g)}else if(d){var g=new f(d);if(g.set({id:d.expenseId}),g.attributes.tags&&!(g.attributes.tags instanceof Array)){var i=[];i.push(g.attributes.tags),g.set({tags:i})}if(g.attributes.categories&&!(g.attributes.categories instanceof Array)){var j=[];j.push(g.attributes.categories),g.set({categories:j})}c.expenseFilterCollection.push(g)}}if(200==b.status){var k=c.buildFilterEntityList();backboneGlobalObj.trigger("entity:displaylist",k)}a(".modal-header").find("button.close").click()})}});b.expenseView=new i({collection:new h})}(jQuery,window,document),function(a,b,c){"use strict";var d=Backbone.Model.extend({urlRoot:"/iPersonal/dashboard/entities/count",defaults:{bookmarks:0,notes:0,pins:0,todos:0,diaries:0,expenses:0}}),e=Backbone.View.extend({el:a("#side-menu"),template:a("#side-menu-template").html(),initialize:function(){this.getCount()},events:{"click img.add-entity-icon":"renderAddEntityForm","click a":"renderListEntityForm"},getCount:function(){var a=this;entityCountModel.fetch().done(function(b){a.render()})},render:function(){var a=_.template(this.template);return this.$el.html(a(entityCountModel.toJSON())),this},renderAddEntityForm:function(b){b.preventDefault();var c=a(b.target).data("entity");backboneGlobalObj.trigger("entity:createform",c.toUpperCase())},renderListEntityForm:function(b){b.preventDefault();var c=a(b.target).data("entity");backboneGlobalObj.trigger("entity:fetchlist",c.toUpperCase())},refreshCount:function(a,b){switch(a){case"BOOKMARK":var c=parseInt(entityCountModel.get("bookmarks"))+parseInt(b);entityCountModel.set({bookmarks:c});break;case"NOTE":var c=parseInt(entityCountModel.get("notes"))+parseInt(b);entityCountModel.set({notes:c});break;case"PIN":var c=parseInt(entityCountModel.get("pins"))+parseInt(b);entityCountModel.set({pins:c});break;case"TODO":var c=parseInt(entityCountModel.get("todos"))+parseInt(b);entityCountModel.set({todos:c});break;case"DIARY":var c=parseInt(entityCountModel.get("diaries"))+parseInt(b);entityCountModel.set({diaries:c});break;case"EXPENSE":var c=parseInt(entityCountModel.get("expenses"))+parseInt(b);entityCountModel.set({expenses:c})}this.render()}}),f=Backbone.View.extend({el:a("#entity-wrapper"),initialize:function(){backboneGlobalObj.on("entity:createform",function(a){switch(a){case"BOOKMARK":bookmarkView.renderCreateTemplate(),bookmarkView.prepareVariables(),Init.initBookmark();break;case"NOTE":noteView.renderCreateTemplate(),noteView.prepareVariables(),Init.initNote();break;case"PIN":pinView.renderCreateTemplate(),pinView.prepareVariables(),Init.initPin();break;case"TODO":todoView.renderCreateTemplate(),todoView.prepareVariables(),Init.initTodo();break;case"DIARY":diaryView.renderCreateTemplate(),diaryView.prepareVariables(),Init.initDiary();break;case"EXPENSE":expenseView.renderCreateTemplate(),expenseView.prepareVariables(),Init.initExpense()}}),backboneGlobalObj.on("entity:fetchlist",function(a){switch(a){case"BOOKMARK":bookmarkView.fetchBookmarks();break;case"NOTE":noteView.fetchNotes();break;case"PIN":pinView.fetchPins();break;case"TODO":todoView.fetchTodos();break;case"DIARY":diaryView.fetchPages();break;case"EXPENSE":expenseView.fetchExpenses();break;case"ALL":}})}});b.entityCountModel=new d,b.entityCountView=new e,b.entityWrapperView=new f}(jQuery,window,document),function(a,b,c){"use strict";var d=Backbone.View.extend({el:a("#list-wrapper"),listTemplate:a("#entity-list-template").html(),events:{"click li.clickable":"displayEntity","click a.more":"fetchMore"},initialize:function(){},fetchMore:function(b){b.preventDefault();var c=a(b.target).data("entity");backboneGlobalObj.trigger("entity:fetchlist",c.toUpperCase())},renderList:function(a){var b=0;if(a.length>0){var c=a[0].entityType+"s";b=entityCountModel.get(c)}this.$el.empty();var d=_.template(this.listTemplate);return this.$el.html(d({entities:a,count:b})),this},displayEntity:function(b){var c=a(b.target).closest("li.clickable"),d=c.data("entity"),e=c.data("id");switch(d.toUpperCase()){case"BOOKMARK":bookmarkView.displayEntity(e,"id","bookmark");break;case"NOTE":noteView.displayEntity(e,"id","note");break;case"PIN":pinView.displayEntity(e,"id","pin");break;case"TODO":todoView.displayEntity(e,"id","todo");break;case"DIARY":diaryView.displayEntity(e,"id","diary");break;case"EXPENSE":expenseView.displayEntity(e,"id","expense")}}});b.entityListView=new d}(jQuery,window,document),function(a,b,c){"use strict";var d=Base.extend({urlRoot:"/iPersonal/dashboard/search"}),e=(Base.extend({}),Base.extend({})),f=Backbone.Collection.extend({model:e}),g=BaseView.extend({entityType:"GENERAL",el:a("#search-wrapper"),generalSearchForm:a("#general-search-form"),expenseSearchForm:a("#expense-search-form"),events:{"click #search":"search","click a":"toggleSearch"},search:function(a){var b=this.$el.find(".nav-tabs").find("li.active").data("type");"general"==b?this.searchEntities(a):this.searchExpenses(a)},searchEntities:function(b){var c=this;b.preventDefault(),this.model=new d;var g=this.generalSearchForm.find("#search-entity").val(),h=this.generalSearchForm.find("#search-tag").val(),i=this.generalSearchForm.find("#search-title").val(),j=this.generalSearchForm.find("#search-keyword").val();g&&this.model.set({entityTypes:g}),h&&this.model.set({tags:h}),i&&this.model.set({titles:i}),j&&this.model.set({keywords:j});var k=this.model.save({success:function(a){},error:function(a){}});k&&k.complete(function(b){if(200==b.status){c.collection=new f;var d=JSON.parse(b.responseText);if(d)if(d=d.searchDocument,d instanceof Array)for(var g in d){var h=new e;h.set({entityType:d[g].entityType,entityId:d[g].documentId,modifiedAt:d[g].createdAt,entityTitle:d[g].title,tags:[]}),"BOOKMARK"==h.get("entityType")||"PIN"==h.get("entityType")?h.set({url:d[g].summary.split("###")[0],entitySummary:d[g].summary.split("###")[1]}):"EXPENSE"==h.get("entityType")?h.set({amount:d[g].summary.split("###")[0],entitySummary:d[g].summary.split("###")[1]}):h.set({entitySummary:d[g].summary}),c.collection.add(h)}else{var h=new e({entityType:d.entityType,entityId:d.documentId,modifiedAt:d.createdAt,entityTitle:d.title,tags:[]});"BOOKMARK"==h.get("entityType")||"PIN"==h.get("entityType")?h.set({url:d.summary.split("###")[0],entitySummary:d.summary.split("###")[1]}):"EXPENSE"==h.get("entityType")?h.set({amount:d.summary.split("###")[0],entitySummary:d.summary.split("###")[1]}):h.set({entitySummary:d.summary}),c.collection.add(h)}var i=c.buildEntityList();c.resetModal(),a(".modal-header").find("button.close").click(),backboneGlobalObj.trigger("entity:displaylist",i)}})},searchExpenses:function(a){var b={},c=this.expenseSearchForm.find("#search-category").val();c&&(b.categories=c);var d=this.expenseSearchForm.find("[name=start-amount]").val();d&&!isNaN(d)&&(b.lowerRange=d);var e=this.expenseSearchForm.find("[name=end-amount]").val();e&&!isNaN(e)&&(b.upperRange=e);var f=this.expenseSearchForm.find("[name=start-date]").val();if(f){var g=(new Date(f).getTime()/1e3).toFixed(0);isNaN(g)||(b.startDate=g)}var h=this.expenseSearchForm.find("[name=end-date]").val();if(h){var i=(new Date(h).getTime()/1e3).toFixed(0);isNaN(i)||(b.endDate=i)}expenseView.searchExpenses(b)},buildEntityList:function(){for(var a=[],b=0;b<this.collection.length;b++){var c={};c.entityId=this.collection.models[b].attributes.entityId,c.entityType=this.collection.models[b].attributes.entityType.toLowerCase(),c.entityTitle=this.collection.models[b].attributes.entityTitle,c.entitySummary=this.collection.models[b].attributes.entitySummary,c.modifiedAt=this.collection.models[b].attributes.modifiedAt,("BOOKMARK"==this.collection.models[b].attributes.entityType||"PIN"==this.collection.models[b].attributes.entityType)&&(c.url=this.collection.models[b].attributes.url),"EXPENSE"==this.collection.models[b].attributes.entityType&&(c.amount=this.collection.models[b].attributes.amount),a.push(c)}return a},resetModal:function(){this.generalSearchForm.find("#search-entity").val("").trigger("chosen:updated"),this.generalSearchForm.find("#search-tag").val("").trigger("chosen:updated"),this.generalSearchForm.find("#search-title").val("").trigger("chosen:updated"),this.generalSearchForm.find("#search-keyword").val("").trigger("chosen:updated")},toggleSearch:function(b){var c=a(b.target).attr("href");a(c).removeClass("invisible").siblings(".tab-pane").addClass("invisible")}});b.searchView=new g}(jQuery,window,document);